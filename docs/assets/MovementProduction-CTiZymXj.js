import{d as N,c as A,o as B,_ as E,r as s,b as O,e as t,f as v,w as n,g as p,F as V,j as K,k as L,R as ve,P as pe,S as fe,i as W,t as Z,q as ge,a as j,m as H,l as ye,n as be,p as _e,h as z}from"./index-wk7n1h-6.js";const Me={class:"title"},he=N({__name:"MovementProductionTitle",setup(x){return(U,f)=>(B(),A("h2",Me,"生产批次管理"))}}),ke=E(he,[["__scopeId","data-v-54b4249c"]]),we={class:"movement-production-header"},xe={class:"header-content"},Ce={class:"search-section"},qe={class:"filter-section"},Be={class:"action-section"},Fe=N({__name:"MovementProductionHeader",props:{searchText:{type:String,default:""},filterDeviceModel:{type:String,default:"all"},filterManufacturer:{type:String,default:"all"},uniqueDeviceModels:{type:Array,default:()=>[]},uniqueManufacturers:{type:Array,default:()=>[]}},emits:["update:searchText","update:filterDeviceModel","update:filterManufacturer","refresh","add-batch","configure-columns","apply-filters"],setup(x,{emit:U}){const f=x,c=U,k=s(f.searchText),w=s(f.filterDeviceModel),C=s(f.filterManufacturer),$=r=>{k.value=r,c("update:searchText",r)},d=()=>{c("refresh")},g=()=>{c("add-batch")},q=()=>{c("configure-columns")},u=()=>{c("update:filterDeviceModel",w.value),c("update:filterManufacturer",C.value),c("apply-filters")};return(r,i)=>{const P=v("a-input-search"),o=v("a-select-option"),S=v("a-select"),F=v("a-button");return B(),A("div",we,[O("div",xe,[O("div",Ce,[t(P,{value:k.value,"onUpdate:value":i[0]||(i[0]=m=>k.value=m),placeholder:"搜索设备型号、生产批次、生产厂家...",style:{width:"300px"},onSearch:$,"allow-clear":""},null,8,["value"])]),O("div",qe,[t(S,{value:w.value,"onUpdate:value":i[1]||(i[1]=m=>w.value=m),placeholder:"设备型号",style:{width:"150px","margin-right":"8px"},"allow-clear":""},{default:n(()=>[t(o,{value:"all"},{default:n(()=>i[3]||(i[3]=[p("全部型号")])),_:1,__:[3]}),(B(!0),A(V,null,K(x.uniqueDeviceModels,m=>(B(),W(o,{key:m,value:m},{default:n(()=>[p(Z(m),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),t(S,{value:C.value,"onUpdate:value":i[2]||(i[2]=m=>C.value=m),placeholder:"生产厂家",style:{width:"150px","margin-right":"8px"},"allow-clear":""},{default:n(()=>[t(o,{value:"all"},{default:n(()=>i[4]||(i[4]=[p("全部厂家")])),_:1,__:[4]}),(B(!0),A(V,null,K(x.uniqueManufacturers,m=>(B(),W(o,{key:m,value:m},{default:n(()=>[p(Z(m),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]),t(F,{type:"primary",onClick:u},{default:n(()=>i[5]||(i[5]=[p("应用筛选")])),_:1,__:[5]})]),O("div",Be,[t(F,{onClick:d,style:{"margin-right":"8px"}},{icon:n(()=>[t(L(ve))]),default:n(()=>[i[6]||(i[6]=p(" 刷新 "))]),_:1,__:[6]}),t(F,{type:"primary",onClick:g,style:{"margin-right":"8px"}},{icon:n(()=>[t(L(pe))]),default:n(()=>[i[7]||(i[7]=p(" 新增批次 "))]),_:1,__:[7]}),t(F,{onClick:q},{icon:n(()=>[t(L(fe))]),default:n(()=>[i[8]||(i[8]=p(" 列配置 "))]),_:1,__:[8]})])])])}}}),Pe=E(Fe,[["__scopeId","data-v-6df1f230"]]),Se=N({__name:"MovementProductionTable",props:{columns:{type:Array,required:!0},data:{type:Array,required:!0},loading:{type:Boolean,default:!1},pagination:{type:Object,required:!0}},emits:["change","edit-record","delete-record","upload-bom","download-bom"],setup(x,{emit:U}){const f=U,c=d=>{f("change",d)},k=d=>{f("edit-record",d)},w=d=>{f("delete-record",d)},C=d=>{f("upload-bom",d)},$=d=>{f("download-bom",d)};return(d,g)=>{const q=v("a-button"),u=v("a-popconfirm"),r=v("a-table");return B(),W(r,{columns:x.columns,"data-source":x.data,loading:x.loading,pagination:x.pagination,onChange:c,bordered:"",scroll:{x:1500}},{bodyCell:n(({column:i,record:P})=>[i.key==="operation"?(B(),A(V,{key:0},[t(q,{type:"link",size:"small",onClick:o=>k(P)},{default:n(()=>g[0]||(g[0]=[p("编辑")])),_:2,__:[0]},1032,["onClick"]),t(u,{title:"确定删除吗?",onConfirm:o=>w(P),"ok-text":"是","cancel-text":"否"},{default:n(()=>[t(q,{type:"link",size:"small"},{default:n(()=>g[1]||(g[1]=[p("删除")])),_:1,__:[1]})]),_:2},1032,["onConfirm"]),t(q,{type:"link",size:"small",onClick:o=>C(P)},{default:n(()=>g[2]||(g[2]=[p("上传BOM")])),_:2,__:[2]},1032,["onClick"]),t(q,{type:"link",size:"small",onClick:o=>$(P)},{default:n(()=>g[3]||(g[3]=[p("下载BOM")])),_:2,__:[3]},1032,["onClick"])],64)):ge("",!0)]),_:1},8,["columns","data-source","loading","pagination"])}}}),Te=E(Se,[["__scopeId","data-v-118ce67e"]]),De={class:"movement-production-container"},Ue=N({__name:"MovementProduction",setup(x){const U=s([]),f=s(!1),c=s(""),k=s("all"),w=s("all"),C=s(!1),$=s(!1),d=s(!1),g=s(null),q=s(null),u=j({key:"",serialNumber:0,deviceModel:"",productionBatch:"",manufacturer:"",burnedFirmware:"",unitPrice:0,quantity:0,totalPrice:0,creator:"",creationTime:"",updateTime:""}),r=j({deviceModel:"",productionBatch:"",manufacturer:"",burnedFirmware:"",unitPrice:0,quantity:0}),i={deviceModel:[{required:!0,message:"请输入设备型号",trigger:"blur"}],productionBatch:[{required:!0,message:"请输入生产批次",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入生产厂家",trigger:"blur"}],burnedFirmware:[{required:!0,message:"请输入烧录固件",trigger:"blur"}],unitPrice:[{required:!0,type:"number",min:0,message:"请输入单价",trigger:"blur"}],quantity:[{required:!0,type:"number",min:0,message:"请输入数量",trigger:"blur"}]},P={deviceModel:[{required:!0,message:"请输入设备型号",trigger:"blur"}],manufacturer:[{required:!0,message:"请输入生产厂家",trigger:"blur"}],burnedFirmware:[{required:!0,message:"请输入烧录固件",trigger:"blur"}],unitPrice:[{required:!0,type:"number",min:0,message:"请输入单价",trigger:"blur"}],quantity:[{required:!0,type:"number",min:0,message:"请输入数量",trigger:"blur"}]},o=j({current:1,pageSize:10,total:0,showTotal:a=>`第 ${(o.current-1)*o.pageSize+1}-${Math.min(o.current*o.pageSize,a)}条/共 ${a} 条`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),S=[{title:"序号",dataIndex:"serialNumber",key:"serialNumber",fixed:"left",width:70},{title:"设备型号",dataIndex:"deviceModel",key:"deviceModel",width:120},{title:"生产批次",dataIndex:"productionBatch",key:"productionBatch",width:120,sorter:!0},{title:"生产厂家",dataIndex:"manufacturer",key:"manufacturer",width:150},{title:"烧录固件",dataIndex:"burnedFirmware",key:"burnedFirmware",width:120},{title:"单价 (元)",dataIndex:"unitPrice",key:"unitPrice",width:100,sorter:!0},{title:"数量 (个)",dataIndex:"quantity",key:"quantity",width:100,sorter:!0},{title:"总价 (元)",dataIndex:"totalPrice",key:"totalPrice",width:100,sorter:!0},{title:"创建人",dataIndex:"creator",key:"creator",width:100},{title:"创建时间",dataIndex:"creationTime",key:"creationTime",sorter:!0,width:150},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:150},{title:"操作",key:"operation",fixed:"right",width:250}],F=s(S.map(a=>a.key)),m=s(S.map(a=>a.key)),y=s([]),Y=H(()=>{const a=new Set(y.value.map(e=>e.deviceModel));return Array.from(a)}),ee=H(()=>{const a=new Set(y.value.map(e=>e.manufacturer));return Array.from(a)}),te=H(()=>m.value.map(e=>S.find(_=>_.key===e)).filter(e=>e!==void 0).filter(e=>F.value.includes(e.key))),T=async()=>{f.value=!0,await new Promise(_=>setTimeout(_,1e3));const a=Array.from({length:50}).map((_,b)=>{const I=parseFloat((Math.random()*50+50).toFixed(2)),D=Math.floor(Math.random()*500)+100,M=parseFloat((I*D).toFixed(2));return{key:`production-${b+1}`,serialNumber:b+1,deviceModel:`HWSZ00${b%5}`,productionBatch:`Batch-${20230101+b}`,manufacturer:`Manufacturer-${b%3}`,burnedFirmware:`Firmware-V1.0.${b}`,unitPrice:I,quantity:D,totalPrice:M,creator:`user${b%5}`,creationTime:`2023-01-01 10:00:${String(b).padStart(2,"0")}`,updateTime:`2023-01-01 11:00:${String(b).padStart(2,"0")}`}});y.value=a;const e=y.value.filter(_=>{const b=k.value==="all"||_.deviceModel===k.value,I=w.value==="all"||_.manufacturer===w.value,D=!c.value||Object.values(_).some(M=>String(M).toLowerCase().includes(c.value.toLowerCase()));return b&&I&&D});U.value=e.slice((o.current-1)*o.pageSize,o.current*o.pageSize),o.total=e.length,f.value=!1},ae=a=>{o.current=a.current,o.pageSize=a.pageSize,T()},ne=()=>{C.value=!0},G=()=>{C.value=!1},le=()=>{F.value=S.map(a=>a.key)},re=()=>{$.value=!0},oe=async()=>{var a;try{await((a=g.value)==null?void 0:a.validate());const e={key:`production-${y.value.length+1}`,serialNumber:y.value.length+1,deviceModel:r.deviceModel,productionBatch:r.productionBatch,manufacturer:r.manufacturer,burnedFirmware:r.burnedFirmware,unitPrice:r.unitPrice,quantity:r.quantity,totalPrice:r.unitPrice*r.quantity,creator:"admin",creationTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()};y.value.push(e),z.success("批次添加成功!"),T(),J()}catch(e){console.error("Validation Failed:",e)}},J=()=>{var a;$.value=!1,(a=g.value)==null||a.resetFields()},ue=a=>{Object.assign(u,a),d.value=!0},ie=async()=>{var a;try{await((a=q.value)==null?void 0:a.validate());const e=y.value.findIndex(_=>_.key===u.key);e!==-1&&(Object.assign(y.value[e],u),y.value[e].totalPrice=u.unitPrice*u.quantity,y.value[e].updateTime=new Date().toLocaleString()),z.success("批次更新成功!"),T(),Q()}catch(e){console.error("Validation Failed:",e)}},Q=()=>{var a;d.value=!1,(a=q.value)==null||a.resetFields()},de=a=>{y.value=y.value.filter(e=>e.key!==a.key),z.success("批次删除成功!"),T()},se=a=>{console.log("Uploading BOM for record:",a),z.info(`上传/下载BOM for ${a.productionBatch}`)},ce=a=>{console.log("Downloading BOM for record:",a),z.info(`下载BOM for ${a.productionBatch}`)},me=()=>{T()};return ye([k,w,c,()=>o.current,()=>o.pageSize],()=>{o.current=1,_e(()=>T())}),be(()=>{T()}),(a,e)=>{const _=v("a-button"),b=v("a-checkbox"),I=v("a-checkbox-group"),D=v("a-modal"),M=v("a-input"),h=v("a-form-item"),R=v("a-input-number"),X=v("a-form");return B(),A("div",De,[t(ke),t(Pe,{searchText:c.value,"onUpdate:searchText":e[0]||(e[0]=l=>c.value=l),filterDeviceModel:k.value,"onUpdate:filterDeviceModel":e[1]||(e[1]=l=>k.value=l),filterManufacturer:w.value,"onUpdate:filterManufacturer":e[2]||(e[2]=l=>w.value=l),"unique-device-models":Y.value,"unique-manufacturers":ee.value,onRefresh:T,onAddBatch:re,onConfigureColumns:ne,onApplyFilters:me},null,8,["searchText","filterDeviceModel","filterManufacturer","unique-device-models","unique-manufacturers"]),t(Te,{columns:te.value,data:U.value,loading:f.value,pagination:o,onChange:ae,onEditRecord:ue,onDeleteRecord:de,onUploadBom:se,onDownloadBom:ce},null,8,["columns","data","loading","pagination"]),t(D,{title:"Configure Table Columns",visible:C.value,"onUpdate:visible":e[4]||(e[4]=l=>C.value=l),onCancel:G,onOk:G},{default:n(()=>[O("div",null,[O("h3",null,[e[18]||(e[18]=p(" Visible Columns ")),t(_,{type:"link",onClick:le,style:{float:"right"}},{default:n(()=>e[17]||(e[17]=[p("Select All")])),_:1,__:[17]})]),t(I,{value:F.value,"onUpdate:value":e[3]||(e[3]=l=>F.value=l)},{default:n(()=>[(B(),A(V,null,K(S,l=>O("div",{key:l.key},[t(b,{value:l.key},{default:n(()=>[p(Z(l.title),1)]),_:2},1032,["value"])])),64))]),_:1},8,["value"])])]),_:1},8,["visible"]),t(D,{visible:$.value,title:"新增批次",onOk:oe,onCancel:J},{default:n(()=>[t(X,{model:r,rules:i,ref_key:"addForm",ref:g,layout:"vertical"},{default:n(()=>[t(h,{label:"设备型号",name:"deviceModel"},{default:n(()=>[t(M,{value:r.deviceModel,"onUpdate:value":e[5]||(e[5]=l=>r.deviceModel=l)},null,8,["value"])]),_:1}),t(h,{label:"生产批次",name:"productionBatch"},{default:n(()=>[t(M,{value:r.productionBatch,"onUpdate:value":e[6]||(e[6]=l=>r.productionBatch=l)},null,8,["value"])]),_:1}),t(h,{label:"生产厂家",name:"manufacturer"},{default:n(()=>[t(M,{value:r.manufacturer,"onUpdate:value":e[7]||(e[7]=l=>r.manufacturer=l)},null,8,["value"])]),_:1}),t(h,{label:"烧录固件",name:"burnedFirmware"},{default:n(()=>[t(M,{value:r.burnedFirmware,"onUpdate:value":e[8]||(e[8]=l=>r.burnedFirmware=l)},null,8,["value"])]),_:1}),t(h,{label:"单价 (元)",name:"unitPrice"},{default:n(()=>[t(R,{value:r.unitPrice,"onUpdate:value":e[9]||(e[9]=l=>r.unitPrice=l),min:0},null,8,["value"])]),_:1}),t(h,{label:"数量 (个)",name:"quantity"},{default:n(()=>[t(R,{value:r.quantity,"onUpdate:value":e[10]||(e[10]=l=>r.quantity=l),min:0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"]),t(D,{visible:d.value,title:"编辑批次信息",onOk:ie,onCancel:Q},{default:n(()=>[t(X,{model:u,rules:P,ref_key:"editForm",ref:q,layout:"vertical"},{default:n(()=>[t(h,{label:"设备型号",name:"deviceModel"},{default:n(()=>[t(M,{value:u.deviceModel,"onUpdate:value":e[11]||(e[11]=l=>u.deviceModel=l)},null,8,["value"])]),_:1}),t(h,{label:"生产批次",name:"productionBatch"},{default:n(()=>[t(M,{value:u.productionBatch,"onUpdate:value":e[12]||(e[12]=l=>u.productionBatch=l),disabled:!0},null,8,["value"])]),_:1}),t(h,{label:"生产厂家",name:"manufacturer"},{default:n(()=>[t(M,{value:u.manufacturer,"onUpdate:value":e[13]||(e[13]=l=>u.manufacturer=l)},null,8,["value"])]),_:1}),t(h,{label:"烧录固件",name:"burnedFirmware"},{default:n(()=>[t(M,{value:u.burnedFirmware,"onUpdate:value":e[14]||(e[14]=l=>u.burnedFirmware=l)},null,8,["value"])]),_:1}),t(h,{label:"单价 (元)",name:"unitPrice"},{default:n(()=>[t(R,{value:u.unitPrice,"onUpdate:value":e[15]||(e[15]=l=>u.unitPrice=l),min:0},null,8,["value"])]),_:1}),t(h,{label:"数量 (个)",name:"quantity"},{default:n(()=>[t(R,{value:u.quantity,"onUpdate:value":e[16]||(e[16]=l=>u.quantity=l),min:0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),Oe=E(Ue,[["__scopeId","data-v-4d98eb62"]]);export{Oe as default};
