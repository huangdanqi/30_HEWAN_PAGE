import{e,I as le,d as N,c as V,b as M,o as f,_ as z,r as k,j as q,f as i,w as a,g as D,F as E,k as H,l as K,R as ne,S as oe,i as F,t as j,q as O,a as ee,m as B,h as Y,n as se,p as re}from"./index-BwXPi_UQ.js";var ie={icon:{tag:"svg",attrs:{viewBox:"0 0 1024 1024",focusable:"false"},children:[{tag:"path",attrs:{d:"M885.2 446.3l-.2-.8-112.2-285.1c-5-16.1-19.9-27.2-36.8-27.2H281.2c-17 0-32.1 11.3-36.9 27.6L139.4 443l-.3.7-.2.8c-1.3 4.9-1.7 9.9-1 14.8-.1 1.6-.2 3.2-.2 4.8V830a60.9 60.9 0 0060.8 60.8h627.2c33.5 0 60.8-27.3 60.9-60.8V464.1c0-1.3 0-2.6-.1-3.7.4-4.9 0-9.6-1.3-14.1zm-295.8-43l-.3 15.7c-.8 44.9-31.8 75.1-77.1 75.1-22.1 0-41.1-7.1-54.8-20.6S436 441.2 435.6 419l-.3-15.7H229.5L309 210h399.2l81.7 193.3H589.4zm-375 76.8h157.3c24.3 57.1 76 90.8 140.4 90.8 33.7 0 65-9.4 90.3-27.2 22.2-15.6 39.5-37.4 50.7-63.6h156.5V814H214.4V480.1z"}}]},name:"inbox",theme:"outlined"};function ae(v){for(var m=1;m<arguments.length;m++){var u=arguments[m]!=null?Object(arguments[m]):{},o=Object.keys(u);typeof Object.getOwnPropertySymbols=="function"&&(o=o.concat(Object.getOwnPropertySymbols(u).filter(function(l){return Object.getOwnPropertyDescriptor(u,l).enumerable}))),o.forEach(function(l){ue(v,l,u[l])})}return v}function ue(v,m,u){return m in v?Object.defineProperty(v,m,{value:u,enumerable:!0,configurable:!0,writable:!0}):v[m]=u,v}var te=function(m,u){var o=ae({},m,u.attrs);return e(le,ae({},o,{icon:ie}),null)};te.displayName="InboxOutlined";te.inheritAttrs=!1;const de={class:"firmware-title-container"},ce=N({__name:"FirmwareTitle",setup(v){return(m,u)=>(f(),V("div",de,u[0]||(u[0]=[M("h2",null,"固件管理",-1)])))}}),ve=z(ce,[["__scopeId","data-v-eda919b8"]]),pe={class:"firmware-header-container"},me={class:"select-container"},fe=N({__name:"FirmwareHeader",props:{searchText:String,filterDeviceModel:String,uniqueDeviceModels:{type:Array,default:()=>[]},filterDeviceStatus:String,uniqueDeviceStatuses:{type:Array,default:()=>[]}},emits:["update:searchText","refresh","release-version","configure-columns","update:filterDeviceModel","update:filterDeviceStatus"],setup(v,{emit:m}){const u=v,o=m,l=k(u.searchText),b=k(u.filterDeviceModel),s=k(u.filterDeviceStatus);q(()=>u.searchText,r=>{l.value=r}),q(()=>u.filterDeviceModel,r=>{b.value=r}),q(()=>u.filterDeviceStatus,r=>{s.value=r}),q(l,r=>{o("update:searchText",r)});const h=()=>{o("refresh")},p=()=>{o("release-version")},x=()=>{o("configure-columns")};return(r,_)=>{const $=i("a-select-option"),U=i("a-select"),y=i("a-input-search"),g=i("a-space"),t=i("a-col"),T=i("a-button"),R=i("a-row");return f(),V("div",pe,[e(R,{justify:"space-between",align:"middle"},{default:a(()=>[e(t,null,{default:a(()=>[e(g,null,{default:a(()=>[M("div",me,[_[4]||(_[4]=M("span",{class:"select-always-placeholder"},"设备型号: ",-1)),e(U,{value:b.value,"onUpdate:value":_[0]||(_[0]=w=>b.value=w),style:{width:"150px"},onChange:_[1]||(_[1]=w=>o("update:filterDeviceModel",w))},{default:a(()=>[e($,{value:"all"},{default:a(()=>_[3]||(_[3]=[D("全部")])),_:1,__:[3]}),(f(!0),V(E,null,H(v.uniqueDeviceModels,w=>(f(),F($,{key:w,value:w},{default:a(()=>[D(j(w),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"])]),e(y,{value:l.value,"onUpdate:value":_[2]||(_[2]=w=>l.value=w),placeholder:"输入关键字搜索",style:{width:"200px"},allowClear:""},null,8,["value"])]),_:1})]),_:1}),e(t,null,{default:a(()=>[e(g,null,{default:a(()=>[e(T,{type:"primary",onClick:p},{default:a(()=>_[5]||(_[5]=[D("版本发布")])),_:1,__:[5]}),e(T,{onClick:h},{icon:a(()=>[e(K(ne))]),_:1}),e(T,{onClick:x},{icon:a(()=>[e(K(oe))]),_:1})]),_:1})]),_:1})]),_:1})])}}}),_e=z(fe,[["__scopeId","data-v-3895910f"]]),ge=["onClick"],be=N({__name:"FirmwareTable",props:{columns:{type:Array,required:!0},data:{type:Array,required:!0},loading:Boolean,pagination:{type:Object,required:!0}},emits:["change","edit-record","delete-record"],setup(v,{emit:m}){return(u,o)=>{const l=i("a-divider"),b=i("a-popconfirm"),s=i("a-space"),h=i("a-table");return f(),F(h,{columns:v.columns,"data-source":v.data,loading:v.loading,pagination:v.pagination,onChange:o[0]||(o[0]=p=>u.$emit("change",p)),scroll:{x:1310},"row-key":"key"},{bodyCell:a(({column:p,record:x})=>[p.key==="operation"?(f(),F(s,{key:0},{default:a(()=>[M("a",{onClick:r=>u.$emit("edit-record",x)},"编辑",8,ge),e(l,{type:"vertical"}),e(b,{title:"确定要删除该固件信息吗?",onConfirm:r=>u.$emit("delete-record",x)},{default:a(()=>o[1]||(o[1]=[M("a",{class:"danger-link"},"删除",-1)])),_:2,__:[1]},1032,["onConfirm"])]),_:2},1024)):O("",!0)]),_:1},8,["columns","data-source","loading","pagination"])}}}),ye=z(be,[["__scopeId","data-v-07e22915"]]),Se={class:"steps-content"},ke={key:0},we={style:{"margin-top":"8px"}},xe={key:1},De={class:"ant-upload-drag-icon"},Me={key:0,style:{"margin-top":"16px"}},Ce={class:"steps-action"},he=N({__name:"FirmwareReleaseModal",props:{visible:{type:Boolean,default:!1},uniqueDeviceModels:{type:Array,default:()=>[]}},emits:["update:visible","submit"],setup(v,{emit:m}){const u=m,o=k(0),l=k(null),b=k([]),s=ee({isFirstRelease:!0,deviceModel:"",releaseType:"major",contentDescription:""}),h={deviceModel:[{required:!0,message:"请选择设备型号"}],contentDescription:[{required:!0,message:"请输入内容描述"}],isFirstRelease:[{required:!0,message:"请选择是否首版发布"}],releaseType:[{required:!0,message:"请选择发布版本"}]},p=B(()=>{const g="1.0.0",t=g.split(".").map(Number);if(s.isFirstRelease)return`V ${t[0]}.0.0`;switch(s.releaseType){case"major":return`V ${t[0]+1}.0.0`;case"minor":return`V ${t[0]}.${t[1]+1}.0`;case"revision":return`V ${t[0]}.${t[1]}.${t[2]+1}`;default:return`V ${g}`}});q(()=>s.isFirstRelease,g=>{g&&(s.releaseType="major"),s.deviceModel=""});const x=async()=>{var g;try{await((g=l.value)==null?void 0:g.validateFields()),o.value++}catch(t){console.error("Validation Failed:",t)}},r=()=>{o.value--},_=()=>{console.log("Form State:",s),console.log("File List:",b.value),Y.success("固件发布成功!"),u("submit",{formState:s,files:b.value}),$()},$=()=>{o.value=0,s.isFirstRelease=!0,s.deviceModel="",s.releaseType="major",s.contentDescription="",b.value=[],u("update:visible",!1)},U=g=>{let t=[...g.fileList];t=t.slice(-1),t=t.map(T=>(T.response&&(T.url=T.response.url),T)),b.value=t,g.file.status==="done"?Y.success(`${g.file.name} 文件上传成功.`):g.file.status==="error"&&Y.error(`${g.file.name} 文件上传失败.`)},y=g=>{console.log(g)};return(g,t)=>{const T=i("a-step"),R=i("a-steps"),w=i("a-radio"),A=i("a-radio-group"),I=i("a-form-item"),P=i("a-input"),W=i("a-select-option"),Z=i("a-select"),G=i("a-textarea"),L=i("a-form"),J=i("a-upload-dragger"),d=i("a-progress"),n=i("a-button"),C=i("a-modal");return f(),F(C,{visible:v.visible,title:"版本发布",footer:null,onCancel:$,width:"600px"},{default:a(()=>[e(R,{current:o.value},{default:a(()=>[e(T,{title:"版本选择"}),e(T,{title:"固件上传"})]),_:1},8,["current"]),M("div",Se,[o.value===0?(f(),V("div",ke,[e(L,{model:s,rules:h,ref_key:"step1Form",ref:l,layout:"vertical"},{default:a(()=>[e(I,{label:"首版发布",name:"isFirstRelease"},{default:a(()=>[e(A,{value:s.isFirstRelease,"onUpdate:value":t[0]||(t[0]=c=>s.isFirstRelease=c)},{default:a(()=>[e(w,{value:!0},{default:a(()=>t[5]||(t[5]=[D("是")])),_:1,__:[5]}),e(w,{value:!1},{default:a(()=>t[6]||(t[6]=[D("否")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),e(I,{label:"设备型号",name:"deviceModel"},{default:a(()=>[s.isFirstRelease?(f(),F(P,{key:0,value:s.deviceModel,"onUpdate:value":t[1]||(t[1]=c=>s.deviceModel=c),placeholder:"请输入"},null,8,["value"])):(f(),F(Z,{key:1,value:s.deviceModel,"onUpdate:value":t[2]||(t[2]=c=>s.deviceModel=c),placeholder:"请选择"},{default:a(()=>[(f(!0),V(E,null,H(v.uniqueDeviceModels,c=>(f(),F(W,{key:c,value:c},{default:a(()=>[D(j(c),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1}),s.isFirstRelease?O("",!0):(f(),F(I,{key:0,label:"发布版本",name:"releaseType"},{default:a(()=>[e(A,{value:s.releaseType,"onUpdate:value":t[3]||(t[3]=c=>s.releaseType=c)},{default:a(()=>[e(w,{value:"major"},{default:a(()=>t[7]||(t[7]=[D("主版本")])),_:1,__:[7]}),e(w,{value:"minor"},{default:a(()=>t[8]||(t[8]=[D("子版本")])),_:1,__:[8]}),e(w,{value:"revision"},{default:a(()=>t[9]||(t[9]=[D("修订版")])),_:1,__:[9]})]),_:1},8,["value"]),M("p",we,"本次将发布为 "+j(p.value)+" 版本",1)]),_:1})),e(I,{label:"内容描述",name:"contentDescription"},{default:a(()=>[e(G,{value:s.contentDescription,"onUpdate:value":t[4]||(t[4]=c=>s.contentDescription=c),placeholder:"请输入",rows:4},null,8,["value"])]),_:1})]),_:1},8,["model"])])):O("",!0),o.value===1?(f(),V("div",xe,[e(J,{name:"file",multiple:!1,action:"/upload.do",onChange:U,onDrop:y},{default:a(()=>[M("p",De,[e(K(te))]),t[10]||(t[10]=M("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域",-1)),t[11]||(t[11]=M("p",{class:"ant-upload-hint"}," 请按照模板上传文件进行设备导入。支持文件格式: .xls, .xlsx。 ",-1))]),_:1,__:[10,11]}),b.value.length>0?(f(),V("div",Me,[(f(!0),V(E,null,H(b.value,c=>(f(),V("div",{key:c.uid},[e(d,{percent:c.percent||0},null,8,["percent"]),M("span",null,j(c.name),1)]))),128))])):O("",!0)])):O("",!0)]),M("div",Ce,[o.value<1?(f(),F(n,{key:0,type:"primary",onClick:x},{default:a(()=>t[12]||(t[12]=[D("下一步")])),_:1,__:[12]})):O("",!0),o.value>0?(f(),F(n,{key:1,style:{"margin-left":"8px"},onClick:r},{default:a(()=>t[13]||(t[13]=[D("上一步")])),_:1,__:[13]})):O("",!0),o.value===1?(f(),F(n,{key:2,type:"primary",onClick:_,style:{"margin-left":"8px"}},{default:a(()=>t[14]||(t[14]=[D(" 确定 ")])),_:1,__:[14]})):O("",!0)])]),_:1},8,["visible"])}}}),Te=z(he,[["__scopeId","data-v-4d687a31"]]),$e=N({__name:"FirmwareEditModal",props:{visible:{type:Boolean,default:!1},record:{type:Object,default:null}},emits:["update:visible","submit"],setup(v,{emit:m}){const u=v,o=m,l=ee({key:"",serialNumber:0,deviceModel:"",releaseVersion:"",versionNumber:"",contentDescription:"",creator:"",releaseTime:"",updateTime:"",deviceStatus:""});q(()=>u.record,h=>{h&&Object.assign(l,h)},{immediate:!0});const b=()=>{o("submit",l),o("update:visible",!1)},s=()=>{o("update:visible",!1)};return(h,p)=>{const x=i("a-input"),r=i("a-form-item"),_=i("a-textarea"),$=i("a-form"),U=i("a-modal");return f(),F(U,{visible:v.visible,title:"编辑固件信息",onOk:b,onCancel:s},{default:a(()=>[e($,{model:l,layout:"vertical"},{default:a(()=>[e(r,{label:"设备型号"},{default:a(()=>[e(x,{value:l.deviceModel,"onUpdate:value":p[0]||(p[0]=y=>l.deviceModel=y)},null,8,["value"])]),_:1}),e(r,{label:"发布版本"},{default:a(()=>[e(x,{value:l.releaseVersion,"onUpdate:value":p[1]||(p[1]=y=>l.releaseVersion=y)},null,8,["value"])]),_:1}),e(r,{label:"版本号"},{default:a(()=>[e(x,{value:l.versionNumber,"onUpdate:value":p[2]||(p[2]=y=>l.versionNumber=y)},null,8,["value"])]),_:1}),e(r,{label:"内容描述"},{default:a(()=>[e(_,{value:l.contentDescription,"onUpdate:value":p[3]||(p[3]=y=>l.contentDescription=y),rows:4},null,8,["value"])]),_:1}),e(r,{label:"创建人"},{default:a(()=>[e(x,{value:l.creator,"onUpdate:value":p[4]||(p[4]=y=>l.creator=y)},null,8,["value"])]),_:1}),e(r,{label:"设备状态"},{default:a(()=>[e(x,{value:l.deviceStatus,"onUpdate:value":p[5]||(p[5]=y=>l.deviceStatus=y)},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["visible"])}}}),Fe={class:"firmware-container"},Ve=N({__name:"Firmware",setup(v){const m=k([]),u=k(!1),o=k(""),l=k("all"),b=k("all"),s=k(!1),h=k(!1),p=k(!1),x=k(null),r=ee({current:1,pageSize:10,total:0,showTotal:d=>`第 ${(r.current-1)*r.pageSize+1}-${Math.min(r.current*r.pageSize,d)}条/共 ${d} 条`,showSizeChanger:!0,pageSizeOptions:["10","20","50","100"]}),_=[{title:"序号",dataIndex:"serialNumber",key:"serialNumber",fixed:"left",width:70},{title:"设备型号",dataIndex:"deviceModel",key:"deviceModel",width:120},{title:"发布版本",dataIndex:"releaseVersion",key:"releaseVersion",width:120},{title:"版本号",dataIndex:"versionNumber",key:"versionNumber",sorter:!0,width:120},{title:"内容描述",dataIndex:"contentDescription",key:"contentDescription",width:300},{title:"创建人",dataIndex:"creator",key:"creator",width:100},{title:"发布时间",dataIndex:"releaseTime",key:"releaseTime",sorter:!0,width:150},{title:"更新时间",dataIndex:"updateTime",key:"updateTime",sorter:!0,width:150},{title:"设备状态",dataIndex:"deviceStatus",key:"deviceStatus",width:120},{title:"操作",key:"operation",fixed:"right",width:180}],$=k(_.map(d=>d.key)),U=k(_.map(d=>d.key)),y=k([]),g=B(()=>{const d=new Set(y.value.map(n=>n.deviceModel));return Array.from(d)}),t=B(()=>{const d=new Set(y.value.map(n=>n.deviceStatus));return Array.from(d)}),T=B(()=>U.value.map(n=>_.find(C=>C.key===n)).filter(n=>n!==void 0).filter(n=>$.value.includes(n.key))),R=async()=>{u.value=!0,console.log("Firmware.vue: fetchData called."),console.log("  filterDeviceModel (inside fetchData):",l.value),await new Promise(C=>setTimeout(C,1e3));const d=Array.from({length:50}).map((C,c)=>({key:`firmware-${c+1}`,serialNumber:c+1,deviceModel:`HWSZ00${c%5}`,releaseVersion:c%2===0?"首版":"修订版",versionNumber:`Z001 V 1.0.${c}`,contentDescription:`1.修改压力传感器间隔采样时间，改为300ms。2.增加复合事件类型：压力+触摸。 (${c})`,creator:`${30+c}`,releaseTime:`2025-07-13 19:25:${String(c).padStart(2,"0")}`,updateTime:`2025-07-13 19:25:${String(c).padStart(2,"0")}`,deviceStatus:c%2===0?"在线":"离线"}));y.value=d;const n=y.value.filter(C=>{const c=l.value==="all"||C.deviceModel===l.value,Q=b.value==="all"||C.deviceStatus===b.value,X=!o.value||Object.values(C).some(S=>String(S).toLowerCase().includes(o.value.toLowerCase()));return c&&Q&&X});m.value=n.slice((r.current-1)*r.pageSize,r.current*r.pageSize),r.total=n.length,u.value=!1},w=d=>{r.current=d.current,r.pageSize=d.pageSize,R()},A=d=>{console.log("Editing firmware record:",d),x.value=d,p.value=!0},I=d=>{console.log("Updated firmware record:",d);const n=m.value.findIndex(C=>C.key===d.key);n!==-1&&(m.value[n]=d)},P=d=>{console.log("Deleting firmware record:",d)},W=()=>{console.log("Release Version button clicked"),h.value=!0},Z=d=>{console.log("Firmware Release Data:",d),R()},G=()=>{s.value=!0},L=()=>{s.value=!1},J=()=>{$.value=_.map(d=>d.key)};return q([o,l,b,()=>r.current,()=>r.pageSize],()=>{console.log("Firmware.vue: Watcher triggered. New search/filter criteria:"),console.log("  searchText:",o.value),console.log("  filterDeviceModel:",l.value),console.log("  filterDeviceStatus:",b.value),r.current=1,re(()=>R())}),se(()=>{R()}),(d,n)=>{const C=i("a-button"),c=i("a-checkbox"),Q=i("a-checkbox-group"),X=i("a-modal");return f(),V("div",Fe,[e(ve),e(_e,{searchText:o.value,"onUpdate:searchText":n[0]||(n[0]=S=>o.value=S),filterDeviceModel:l.value,"onUpdate:filterDeviceModel":n[1]||(n[1]=S=>l.value=S),"unique-device-models":g.value,filterDeviceStatus:b.value,"onUpdate:filterDeviceStatus":n[2]||(n[2]=S=>b.value=S),"unique-device-statuses":t.value,onRefresh:R,onReleaseVersion:W,onConfigureColumns:G},null,8,["searchText","filterDeviceModel","unique-device-models","filterDeviceStatus","unique-device-statuses"]),e(ye,{columns:T.value,data:m.value,loading:u.value,pagination:r,onChange:w,onEditRecord:A,onDeleteRecord:P},null,8,["columns","data","loading","pagination"]),e(X,{title:"Configure Table Columns",visible:s.value,"onUpdate:visible":n[4]||(n[4]=S=>s.value=S),onCancel:L,onOk:L},{default:a(()=>[M("div",null,[M("h3",null,[n[8]||(n[8]=D(" Visible Columns ")),e(C,{type:"link",onClick:J,style:{float:"right"}},{default:a(()=>n[7]||(n[7]=[D("Select All")])),_:1,__:[7]})]),e(Q,{value:$.value,"onUpdate:value":n[3]||(n[3]=S=>$.value=S)},{default:a(()=>[(f(),V(E,null,H(_,S=>M("div",{key:S.key},[e(c,{value:S.key},{default:a(()=>[D(j(S.title),1)]),_:2},1032,["value"])])),64))]),_:1},8,["value"])])]),_:1},8,["visible"]),e(Te,{visible:h.value,"onUpdate:visible":n[5]||(n[5]=S=>h.value=S),"unique-device-models":g.value,onSubmit:Z},null,8,["visible","unique-device-models"]),e($e,{visible:p.value,"onUpdate:visible":n[6]||(n[6]=S=>p.value=S),record:x.value,onSubmit:I},null,8,["visible","record"])])}}}),Oe=z(Ve,[["__scopeId","data-v-fcc21a5a"]]);export{Oe as default};
