import{d as we,r as c,j as _,k as xe,i as E,w as n,l as M,f as d,o as F,b as r,e as t,g as y,c as Ce,n as U,t as W,S as Ve,R as Se,m as Me,h as Te,_ as Ne}from"./index-DxvlNLqH.js";import{l as q,t as Ie,C as De,d as Re}from"./vuedraggable.umd-Dpm0IBux.js";import{F as Oe}from"./FirmwareReleaseModal-uFBtUBFr.js";import{F as Ze}from"./FirmwareEditModal-CH5Aq32n.js";import{S as Fe}from"./SettingOutlined-B1YVnB9v.js";import"./InboxOutlined-0UiQZOBg.js";const $e={class:"top-controls-wrapper"},ze={class:"left-aligned-section"},Ae={class:"select-container device-model-select",style:{"margin-left":"10px"}},He={class:"select-container release-version-select",style:{"margin-left":"10px"}},Be={key:0,style:{color:"red","font-weight":"bold","margin-left":"10px"}},Ee={class:"select-container version-number-select",style:{"margin-left":"10px"}},Ue={class:"right-aligned-icons"},We={class:"column-setting-panel",style:{"max-height":"300px","overflow-y":"auto"}},qe={class:"setting-section"},Ke={class:"section-header",style:{display:"flex","justify-content":"space-between"}},Pe={class:"column-checkbox-item",style:{padding:"4px 0"}},je={class:"table-container"},Le=we({__name:"Firmware",setup(Je,{expose:K}){const b=[{key:"rowIndex",title:"序号",dataIndex:"rowIndex",width:60,fixed:"left",customRender:({index:l})=>(C.value-1)*N.value+l+1},{key:"deviceModel",title:"设备型号",dataIndex:"deviceModel",width:100},{key:"releaseVersion",title:"发布版本",dataIndex:"releaseVersion",width:100},{key:"versionNumber",title:"版本号",dataIndex:"versionNumber",width:100,sorter:(l,e)=>l.versionNumber.localeCompare(e.versionNumber),sortDirections:["ascend","descend"]},{key:"description",title:"内容描述",dataIndex:"description",width:600},{key:"creator",title:"创建人",dataIndex:"creator",width:100},{key:"releaseTime",title:"发布时间",dataIndex:"releaseTime",width:180,sorter:(l,e)=>new Date(l.releaseTime).getTime()-new Date(e.releaseTime).getTime(),sortDirections:["ascend","descend"]},{key:"updateTime",title:"更新时间",dataIndex:"updateTime",width:180,sorter:(l,e)=>new Date(l.updateTime).getTime()-new Date(e.updateTime).getTime(),sortDirections:["ascend","descend"]},{key:"operation",title:"操作",dataIndex:"",width:100,fixed:"right"}],w=c(b.map(l=>l.key)),k=c(b.map(l=>l.key)),P=l=>l.map(e=>({title:e.title,dataIndex:e.dataIndex,key:e.key,width:e.width,fixed:e.fixed,sorter:e.sorter,sortDirections:e.sortDirections,sortOrder:h.value&&e.key===h.value.columnKey?h.value.order:void 0,defaultSortOrder:e.defaultSortOrder,customRender:e.customRender?e.customRender:({text:a})=>a==null||a===""?"-":a})),j=_(()=>{const l=w.value.filter(a=>k.value.includes(a)).map(a=>b.find(s=>s.key===a)).filter(Boolean);return P(l).sort((a,s)=>{const i={left:1,undefined:2,right:3},f=i[a.fixed]||2,o=i[s.fixed]||2;return f-o})}),g=[{key:1,deviceModel:"HWSZ001",releaseVersion:"主版本",versionNumber:"Z001 V 1.0.0",description:"desc",creator:"张三",releaseTime:"2025-07-13 19:25:11",updateTime:"2025-07-13 19:25:11"},{key:2,deviceModel:"HWSZ001",releaseVersion:"主版本",versionNumber:"Z001 V 2.0.0",description:"desc",creator:"张三",releaseTime:"2025-08-13 19:25:11",updateTime:"2025-08-13 19:25:11"},{key:3,deviceModel:"HWSZ002",releaseVersion:"主版本",versionNumber:"Z002 V 1.0.0",description:"desc",creator:"李四",releaseTime:"2025-07-14 19:25:11",updateTime:"2025-07-14 19:25:11"},{key:4,deviceModel:"HWSZ002",releaseVersion:"主版本",versionNumber:"Z002 V 2.0.0",description:"desc",creator:"李四",releaseTime:"2025-08-14 19:25:11",updateTime:"2025-08-14 19:25:11"},{key:5,deviceModel:"HWSZ003",releaseVersion:"主版本",versionNumber:"Z003 V 1.0.0",description:"desc",creator:"王五",releaseTime:"2025-07-15 19:25:11",updateTime:"2025-07-15 19:25:11"},{key:6,deviceModel:"HWSZ003",releaseVersion:"主版本",versionNumber:"Z003 V 2.0.0",description:"desc",creator:"王五",releaseTime:"2025-08-15 19:25:11",updateTime:"2025-08-15 19:25:11"},{key:7,deviceModel:"HWSZ003",releaseVersion:"主版本",versionNumber:"Z003 V 3.0.0",description:"desc",creator:"王五",releaseTime:"2025-09-15 19:25:11",updateTime:"2025-09-15 19:25:11"}];console.log("Raw Data:",g);const v=c({key:"all",label:"全部",value:"all"}),m=c({key:"all",label:"全部",value:"all"}),p=c({key:"all",label:"全部",value:"all"}),L=_(()=>{const l=Array.from(new Set(g.map(e=>e.deviceModel)));return[{key:"all",value:"all",label:"全部"},...l.map(e=>({key:e,value:e,label:e}))]}),J=_(()=>{const l=Array.from(new Set(g.map(e=>e.releaseVersion)));return[{key:"all",value:"all",label:"全部"},...l.map(e=>({key:e,value:e,label:e}))]}),Q=_(()=>{const l=Array.from(new Set(g.map(e=>e.versionNumber)));return[{key:"all",value:"all",label:"全部"},...l.map(e=>({key:e,value:e,label:e}))]}),X=l=>{v.value=!l||!l.value||l.value==="all"?{key:"all",label:"全部",value:"all"}:l},Y=l=>{m.value=!l||!l.value||l.value==="all"?{key:"all",label:"全部",value:"all"}:l},G=l=>{p.value=!l||!l.value||l.value==="all"?{key:"all",label:"全部",value:"all"}:l},C=c(1),N=c(10);console.log("Initial deviceModelValue:",v.value);const h=c({columnKey:"updateTime",order:"descend"}),ee=_(()=>({total:D.value.length,current:C.value,pageSize:N.value,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showTotal:(l,e)=>`第${e[0]}-${e[1]}条/共${l}条`,showQuickJumper:{goButton:"页"},onShowSizeChange:(l,e)=>{console.log("onShowSizeChange",l,e),C.value=l,N.value=e},onChange:(l,e)=>{console.log("onChange",l,e),C.value=l,N.value=e}})),le=()=>{console.log("Refresh button clicked!"),R.value=!0,T.value="",C.value=1,A(),v.value={key:"all",label:"全部",value:"all"},m.value={key:"all",label:"全部",value:"all"},p.value={key:"all",label:"全部",value:"all"},setTimeout(()=>{R.value=!1},500)},D=_(()=>{var e;let l=[...g];if(T.value){const a=T.value.toLowerCase();l=l.filter(s=>Object.values(s).some(i=>typeof i=="string"&&i.toLowerCase().includes(a)))}if(v.value&&v.value.value!=="all"&&v.value.value!==""&&(l=l.filter(a=>a.deviceModel===v.value.value)),m.value&&m.value.value!=="all"&&m.value.value!==""&&(l=l.filter(a=>a.releaseVersion===m.value.value)),p.value&&p.value.value!=="all"&&p.value.value!==""&&(l=l.filter(a=>a.versionNumber===p.value.value)),h.value&&h.value.order){const{columnKey:a,order:s}=h.value,i=(e=b.find(f=>f.key===a))==null?void 0:e.sorter;i&&l.sort((f,o)=>{const x=i(f,o);return s==="ascend"?x:-x})}return l}),T=c(""),$=(l,e,a)=>{console.log("Table change:",l,e,a);const s=Array.isArray(a)?a[0]:a;s&&s.order?h.value={columnKey:s.columnKey,order:s.order}:h.value={columnKey:"updateTime",order:"descend"},C.value=1},ae=()=>{console.log("Setting clicked")},R=c(!1),z=c("middle"),te=({key:l})=>{z.value=l},A=()=>{k.value=b.map(l=>l.key),w.value=b.map(l=>l.key)},oe=l=>{const{newIndex:e,oldIndex:a}=l,s=w.value[a],i=[...w.value];i.splice(a,1),i.splice(e,0,s),w.value=i},ne=(l,e)=>{e?k.value.includes(l)||k.value.push(l):k.value=k.value.filter(a=>a!==l)},I=c(!1),se=_(()=>Array.from(new Set(g.map(l=>l.deviceModel)))),ie=()=>{I.value=!0},re=()=>{I.value=!1},ue=l=>{I.value=!1},O=c(!1),Z=c(null),de=()=>{Te.info("开发中")},ce=()=>{O.value=!1,Z.value=null},ve=l=>{O.value=!1,Z.value=null},H=_(()=>{const l=v.value.value,e=m.value.label;if(!l||l==="all"||!e)return"";const a=g.filter(o=>o.deviceModel===l).map(o=>o.versionNumber).map(o=>{const V=o.trim().match(/V\s*(\d+)\.(\d+)\.(\d+)/);return V?{x:parseInt(V[1]),y:parseInt(V[2]),z:parseInt(V[3])}:null}).filter(Boolean);if(console.log("Selected deviceModel:",l),console.log("All versions for this model:",g.filter(o=>o.deviceModel===l).map(o=>o.versionNumber)),console.log("Parsed versions:",a),a.length===0)return e==="主版本"?"V 1.0.0":e==="子版本"?"V 1.1.0":e==="修订版"?"V 1.0.1":"";let s=Math.max(...a.map(o=>o.x)),i=Math.max(...a.filter(o=>o.x===s).map(o=>o.y)),f=Math.max(...a.filter(o=>o.x===s&&o.y===i).map(o=>o.z));return e==="主版本"?`V ${s+1}.0.0`:e==="子版本"?`V ${s}.${i+1}.0`:e==="修订版"?`V ${s}.${i}.${f+1}`:""}),me=_(()=>({...q,Pagination:{...q.Pagination,page:""}}));return xe(()=>{k.value=b.map(l=>l.key)}),K({handleTableChange:$}),(l,e)=>{const a=d("a-select-option"),s=d("a-select"),i=d("a-tooltip"),f=d("a-input"),o=d("a-button"),x=d("a-menu-item"),V=d("a-menu"),pe=d("a-dropdown"),fe=d("a-checkbox"),_e=d("a-popover"),ye=d("a-divider"),be=d("a-popconfirm"),ke=d("a-space"),ge=d("a-table"),he=d("a-config-provider");return F(),E(he,{locale:me.value,theme:{algorithm:M(Ie).defaultAlgorithm}},{default:n(()=>[e[19]||(e[19]=r("div",{class:"title-container"},[r("h2",null,"固件管理")],-1)),r("div",$e,[r("div",ze,[r("div",Ae,[e[7]||(e[7]=r("span",{class:"select-always-placeholder"},"设备型号:",-1)),t(i,{title:v.value.label},{default:n(()=>[t(s,{value:v.value,"onUpdate:value":e[0]||(e[0]=u=>v.value=u),style:{width:"130px"},options:L.value,onChange:X,allowClear:!0,"label-in-value":"",class:"device-model-select"},{default:n(()=>[t(a,{value:"all"},{default:n(()=>e[6]||(e[6]=[y("全部")])),_:1,__:[6]})]),_:1},8,["value","options"])]),_:1},8,["title"])]),r("div",He,[e[9]||(e[9]=r("span",{class:"select-always-placeholder"},"发布版本:",-1)),t(i,{title:m.value.label},{default:n(()=>[t(s,{value:m.value,"onUpdate:value":e[1]||(e[1]=u=>m.value=u),style:{width:"130px"},options:J.value,onChange:Y,allowClear:!0,"label-in-value":"",class:"release-version-select"},{default:n(()=>[t(a,{value:"all"},{default:n(()=>e[8]||(e[8]=[y("全部")])),_:1,__:[8]})]),_:1},8,["value","options"])]),_:1},8,["title"]),H.value?(F(),Ce("span",Be,W(H.value),1)):U("",!0)]),r("div",Ee,[e[11]||(e[11]=r("span",{class:"select-always-placeholder"},"版本号:",-1)),t(i,{title:p.value.label},{default:n(()=>[t(s,{value:p.value,"onUpdate:value":e[2]||(e[2]=u=>p.value=u),style:{width:"120px"},options:Q.value,onChange:G,allowClear:!0,"label-in-value":"",class:"version-number-select"},{default:n(()=>[t(a,{value:"all"},{default:n(()=>e[10]||(e[10]=[y("全部")])),_:1,__:[10]})]),_:1},8,["value","options"])]),_:1},8,["title"])])]),r("div",Ue,[t(f,{value:T.value,"onUpdate:value":e[3]||(e[3]=u=>T.value=u),placeholder:"输入关键字搜索",style:{width:"200px"}},{prefix:n(()=>[t(M(Ve))]),_:1},8,["value"]),t(o,{type:"primary",onClick:ie},{default:n(()=>e[12]||(e[12]=[y("版本发布")])),_:1,__:[12]}),t(M(Se),{onClick:le}),t(pe,null,{overlay:n(()=>[t(V,{onClick:te},{default:n(()=>[t(x,{key:"large"},{default:n(()=>e[13]||(e[13]=[y("宽松")])),_:1,__:[13]}),t(x,{key:"middle"},{default:n(()=>e[14]||(e[14]=[y("中等")])),_:1,__:[14]}),t(x,{key:"small"},{default:n(()=>e[15]||(e[15]=[y("紧凑")])),_:1,__:[15]})]),_:1})]),default:n(()=>[t(M(De),{onClick:e[4]||(e[4]=Me(()=>{},["prevent"]))})]),_:1}),t(_e,{trigger:"click",placement:"bottomRight"},{content:n(()=>[r("div",We,[r("div",qe,[r("div",Ke,[e[17]||(e[17]=r("span",null,"列展示",-1)),t(o,{type:"link",onClick:A},{default:n(()=>e[16]||(e[16]=[y("重置")])),_:1,__:[16]})]),t(M(Re),{modelValue:w.value,"onUpdate:modelValue":e[5]||(e[5]=u=>w.value=u),"item-key":"key",onEnd:oe,class:"column-checkbox-group"},{item:n(({element:u})=>[r("div",Pe,[t(fe,{checked:k.value.includes(u),onChange:S=>ne(u,S.target.checked)},{default:n(()=>{var S;return[y(W((S=b.find(B=>B.key===u))==null?void 0:S.title),1)]}),_:2},1032,["checked","onChange"])])]),_:1},8,["modelValue"])])])]),default:n(()=>[t(M(Fe),{onClick:ae})]),_:1})])]),r("div",je,[t(ge,{columns:j.value,"data-source":D.value,pagination:D.value.length===0?!1:ee.value,loading:R.value,size:z.value,scroll:{x:1e3},onChange:$,showSorterTooltip:!1},{bodyCell:n(({column:u,record:S})=>[u.key==="operation"?(F(),E(ke,{key:0,class:"action-cell",direction:"horizontal"},{default:n(()=>[r("a",{class:"edit-link",onClick:de},"编辑"),t(ye,{type:"vertical"}),t(be,{title:"确定要删除该信息吗?",onConfirm:B=>l.$emit("delete-record",S)},{default:n(()=>e[18]||(e[18]=[r("a",{class:"danger-link"},"删除",-1)])),_:2,__:[18]},1032,["onConfirm"])]),_:2},1024)):U("",!0)]),_:1},8,["columns","data-source","pagination","loading","size"])]),t(Oe,{visible:I.value,uniqueDeviceModels:se.value,"onUpdate:visible":re,onSubmit:ue},null,8,["visible","uniqueDeviceModels"]),t(Ze,{visible:O.value,record:Z.value,"onUpdate:visible":ce,onSubmit:ve},null,8,["visible","record"])]),_:1,__:[19]},8,["locale","theme"])}}}),al=Ne(Le,[["__scopeId","data-v-8a471334"]]);export{al as default};
