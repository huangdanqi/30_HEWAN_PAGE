import{I as Q}from"./InboxOutlined-Bj5fpIPV.js";import{d as W,r as k,a as X,j as Y,p as b,i as c,o as n,f as r,w as s,e as l,b as _,c as f,n as v,g as p,F as w,v as j,t as M,l as Z,h as D,_ as ee}from"./index-BCGmAcLz.js";const te={class:"steps-content"},ae={key:0},se={style:{"margin-top":"8px"}},le={key:1},oe={class:"ant-upload-drag-icon"},ne={key:0,style:{"margin-top":"16px"}},re={class:"steps-action"},R=15,ie=W({__name:"FirmwareEditModal",props:{visible:{type:Boolean,default:!1},record:{type:Object,default:null},uniqueDeviceModels:{type:Array,default:()=>[]}},emits:["update:visible","submit"],setup(F,{emit:S}){const q=F,V=S,d=k(0),C=k(null),y=k([]),t=X({isFirstRelease:!0,deviceModel:"",releaseType:"major",contentDescription:""}),U={deviceModel:[{required:!0,message:"请选择设备型号"}],contentDescription:[{required:!0,message:"请输入内容描述"}],isFirstRelease:[{required:!0,message:"请选择是否首版发布"}],releaseType:[{required:!0,message:"请选择发布版本"}]},B=Y(()=>{const a="1.0.0",e=a.split(".").map(Number);if(t.isFirstRelease)return`V ${e[0]}.0.0`;switch(t.releaseType){case"major":return`V ${e[0]+1}.0.0`;case"minor":return`V ${e[0]}.${e[1]+1}.0`;case"revision":return`V ${e[0]}.${e[1]}.${e[2]+1}`;default:return`V ${a}`}});b(()=>t.deviceModel,a=>{if(a.replace(/\s/g,"").length>R){let i=0,m="";for(let u of a){if(u!==" "&&i++,i>R)break;m+=u}t.deviceModel=m}}),b(()=>t.isFirstRelease,a=>{a&&(t.releaseType="major"),t.deviceModel=""}),b(()=>t.contentDescription,a=>{if(a.replace(/\s/g,"").length>1e4){let i=0,m="";for(let u of a){if(u!==" "&&i++,i>1e4)break;m+=u}t.contentDescription=m}}),b(()=>q.record,a=>{a&&(t.isFirstRelease=a.isFirstRelease??!0,t.deviceModel=a.deviceModel??"",t.releaseType=a.releaseType??"major",t.contentDescription=a.contentDescription??"")},{immediate:!0});const L=async()=>{var a;try{await((a=C.value)==null?void 0:a.validateFields()),d.value++}catch(e){console.error("Validation Failed:",e)}},N=()=>{d.value--},E=()=>{D.success("固件信息编辑成功!"),V("submit",{formState:{...t},files:y.value}),T()},T=()=>{d.value=0,t.isFirstRelease=!0,t.deviceModel="",t.releaseType="major",t.contentDescription="",y.value=[],V("update:visible",!1)},I=a=>{let e=[...a.fileList];e=e.slice(-1),e=e.map(i=>(i.response&&(i.url=i.response.url),i)),y.value=e,a.file.status==="done"?D.success(`${a.file.name} 文件上传成功.`):a.file.status==="error"&&D.error(`${a.file.name} 文件上传失败.`)},O=a=>{console.log(a)};return(a,e)=>{const i=r("a-step"),m=r("a-steps"),u=r("a-radio"),$=r("a-radio-group"),g=r("a-form-item"),A=r("a-input"),h=r("a-select-option"),z=r("a-select"),G=r("a-textarea"),H=r("a-form"),J=r("a-upload-dragger"),K=r("a-progress"),x=r("a-button"),P=r("a-modal");return n(),c(P,{visible:F.visible,title:"编辑固件信息",footer:null,onCancel:T,width:"600px"},{default:s(()=>[l(m,{current:d.value},{default:s(()=>[l(i,{title:"信息编辑"}),l(i,{title:"固件上传"})]),_:1},8,["current"]),_("div",te,[d.value===0?(n(),f("div",ae,[l(H,{model:t,rules:U,ref_key:"step1Form",ref:C,layout:"vertical"},{default:s(()=>[l(g,{label:"首版发布",name:"isFirstRelease"},{default:s(()=>[l($,{value:t.isFirstRelease,"onUpdate:value":e[0]||(e[0]=o=>t.isFirstRelease=o)},{default:s(()=>[l(u,{value:!0},{default:s(()=>e[5]||(e[5]=[p("是")])),_:1,__:[5]}),l(u,{value:!1},{default:s(()=>e[6]||(e[6]=[p("否")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),l(g,{label:"设备型号",name:"deviceModel"},{default:s(()=>[t.isFirstRelease?(n(),c(A,{key:0,value:t.deviceModel,"onUpdate:value":e[1]||(e[1]=o=>t.deviceModel=o),placeholder:"请输入（最多15个字符，不含空格）",maxlength:30},null,8,["value"])):(n(),c(z,{key:1,value:t.deviceModel,"onUpdate:value":e[2]||(e[2]=o=>t.deviceModel=o),placeholder:"请选择"},{default:s(()=>[(n(!0),f(w,null,j(F.uniqueDeviceModels,o=>(n(),c(h,{key:o,value:o},{default:s(()=>[p(M(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1}),t.isFirstRelease?v("",!0):(n(),c(g,{key:0,label:"发布版本",name:"releaseType"},{default:s(()=>[l($,{value:t.releaseType,"onUpdate:value":e[3]||(e[3]=o=>t.releaseType=o)},{default:s(()=>[l(u,{value:"major"},{default:s(()=>e[7]||(e[7]=[p("主版本")])),_:1,__:[7]}),l(u,{value:"minor"},{default:s(()=>e[8]||(e[8]=[p("子版本")])),_:1,__:[8]}),l(u,{value:"revision"},{default:s(()=>e[9]||(e[9]=[p("修订版")])),_:1,__:[9]})]),_:1},8,["value"]),_("p",se,"本次将发布为 "+M(B.value)+" 版本",1)]),_:1})),l(g,{label:"内容描述",name:"contentDescription"},{default:s(()=>[l(G,{value:t.contentDescription,"onUpdate:value":e[4]||(e[4]=o=>t.contentDescription=o),placeholder:"请输入（最多10000个字符，不含空格）",rows:4,maxlength:10020},null,8,["value"])]),_:1})]),_:1},8,["model"])])):v("",!0),d.value===1?(n(),f("div",le,[l(J,{name:"file",multiple:!1,action:"/upload.do",onChange:I,onDrop:O},{default:s(()=>[_("p",oe,[l(Z(Q))]),e[10]||(e[10]=_("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域",-1)),e[11]||(e[11]=_("p",{class:"ant-upload-hint"}," 请按照模板上传文件进行设备导入。支持文件格式: .xls, .xlsx。 ",-1))]),_:1,__:[10,11]}),y.value.length>0?(n(),f("div",ne,[(n(!0),f(w,null,j(y.value,o=>(n(),f("div",{key:o.uid},[l(K,{percent:o.percent||0},null,8,["percent"]),_("span",null,M(o.name),1)]))),128))])):v("",!0)])):v("",!0)]),_("div",re,[d.value<1?(n(),c(x,{key:0,type:"primary",onClick:L},{default:s(()=>e[12]||(e[12]=[p("下一步")])),_:1,__:[12]})):v("",!0),d.value>0?(n(),c(x,{key:1,style:{"margin-left":"8px"},onClick:N},{default:s(()=>e[13]||(e[13]=[p("上一步")])),_:1,__:[13]})):v("",!0),d.value===1?(n(),c(x,{key:2,type:"primary",onClick:E,style:{"margin-left":"8px"}},{default:s(()=>e[14]||(e[14]=[p(" 确定 ")])),_:1,__:[14]})):v("",!0)])]),_:1},8,["visible"])}}}),pe=ee(ie,[["__scopeId","data-v-758022ad"]]);export{pe as F};
