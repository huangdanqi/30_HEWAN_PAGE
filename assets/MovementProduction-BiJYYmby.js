import{e as l,I as Re,d as le,r as m,a as Ue,p as pe,i as Z,o as W,f as r,w as a,b as d,g as x,s as Fe,_ as ae,l as V,j as T,k as $e,S as ze,R as Ae,m as je,t as Le,n as Ye}from"./index-CtWBKoTV.js";import{l as se,t as Ne,C as Ee,d as He}from"./vuedraggable.umd-BEfuS-FY.js";import{F as Ke}from"./FirmwareReleaseModal-BABTt8_2.js";import{S as Ze}from"./SettingOutlined-adrFa0AU.js";import"./InboxOutlined-BOa_tbmU.js";var We={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"};function de(v){for(var g=1;g<arguments.length;g++){var f=arguments[g]!=null?Object(arguments[g]):{},p=Object.keys(f);typeof Object.getOwnPropertySymbols=="function"&&(p=p.concat(Object.getOwnPropertySymbols(f).filter(function(s){return Object.getOwnPropertyDescriptor(f,s).enumerable}))),p.forEach(function(s){Je(v,s,f[s])})}return v}function Je(v,g,f){return g in v?Object.defineProperty(v,g,{value:f,enumerable:!0,configurable:!0,writable:!0}):v[g]=f,v}var ne=function(g,f){var p=de({},g,f.attrs);return l(Re,de({},p,{icon:We}),null)};ne.displayName="UploadOutlined";ne.inheritAttrs=!1;const Qe={style:{display:"flex","justify-content":"flex-end",gap:"8px","margin-top":"16px"}},Ge=le({__name:"AddBatchModal",props:{open:{type:Boolean,default:!1},title:{type:String,default:"新增批次"},deviceModelOptions:{type:Array,default:()=>[]},manufacturerOptions:{type:Array,default:()=>[]},initialValues:{type:Object,default:()=>({})}},emits:["update:open","submit"],setup(v,{emit:g}){const f=v,p=g,s=m(null),n=Ue({deviceModel:"",productionBatch:null,manufacturer:"",burnedFirmware:"",unitPrice:null,quantity:null}),R={deviceModel:[{required:!0,message:"请选择设备型号"}],productionBatch:[{required:!0,message:"请选择生产批次"}],manufacturer:[{required:!0,message:"请选择生产厂家"}],burnedFirmware:[{required:!0,message:"请输入烧录固件"}],unitPrice:[{required:!0,type:"number",message:"请输入单价"}],quantity:[{required:!0,type:"number",message:"请输入数量"}]};pe(()=>f.open,c=>{c&&f.initialValues&&Object.keys(f.initialValues).length>0?(Object.assign(n,f.initialValues),typeof n.productionBatch=="string"&&n.productionBatch&&(n.productionBatch=Fe(n.productionBatch))):c||q()});function q(){var c,o;n.deviceModel="",n.productionBatch=null,n.manufacturer="",n.burnedFirmware="",n.unitPrice=null,n.quantity=null,(o=(c=s.value)==null?void 0:c.resetFields)==null||o.call(c)}async function y(){var c;try{await((c=s.value)==null?void 0:c.validate()),p("submit",{...n}),p("update:open",!1),q()}catch{}}function O(){p("update:open",!1),q()}return(c,o)=>{const I=r("a-select"),C=r("a-form-item"),h=r("a-date-picker"),J=r("a-input"),A=r("a-input-number"),w=r("a-button"),U=r("a-form"),F=r("a-modal");return W(),Z(F,{open:v.open,title:v.title,onOk:y,onCancel:O,footer:null,width:"480px"},{default:a(()=>[l(U,{model:n,rules:R,ref_key:"formRef",ref:s,layout:"vertical"},{default:a(()=>[l(C,{label:"设备型号",name:"deviceModel",required:""},{default:a(()=>[l(I,{value:n.deviceModel,"onUpdate:value":o[0]||(o[0]=k=>n.deviceModel=k),options:v.deviceModelOptions,placeholder:"请选择","allow-clear":"",size:"large"},null,8,["value","options"])]),_:1}),l(C,{label:"生产批次",name:"productionBatch",required:""},{default:a(()=>[l(h,{value:n.productionBatch,"onUpdate:value":o[1]||(o[1]=k=>n.productionBatch=k),style:{width:"100%"},placeholder:"请选择",size:"large"},null,8,["value"])]),_:1}),l(C,{label:"生产厂家",name:"manufacturer",required:""},{default:a(()=>[l(I,{value:n.manufacturer,"onUpdate:value":o[2]||(o[2]=k=>n.manufacturer=k),options:v.manufacturerOptions,placeholder:"请选择","allow-clear":"",size:"large"},null,8,["value","options"])]),_:1}),l(C,{label:"烧录固件",name:"burnedFirmware",required:""},{default:a(()=>[l(J,{value:n.burnedFirmware,"onUpdate:value":o[3]||(o[3]=k=>n.burnedFirmware=k),placeholder:"请输入",size:"large"},null,8,["value"])]),_:1}),l(C,{label:"单价",name:"unitPrice",required:""},{default:a(()=>[l(A,{value:n.unitPrice,"onUpdate:value":o[4]||(o[4]=k=>n.unitPrice=k),style:{width:"100%"},min:"0","addon-after":"元",placeholder:"请输入",size:"large"},null,8,["value"])]),_:1}),l(C,{label:"数量",name:"quantity",required:""},{default:a(()=>[l(A,{value:n.quantity,"onUpdate:value":o[5]||(o[5]=k=>n.quantity=k),style:{width:"100%"},min:"0","addon-after":"个",placeholder:"请输入",size:"large"},null,8,["value"])]),_:1}),d("div",Qe,[l(w,{onClick:O},{default:a(()=>o[6]||(o[6]=[x("取消")])),_:1,__:[6]}),l(w,{type:"primary",onClick:y},{default:a(()=>o[7]||(o[7]=[x("确定")])),_:1,__:[7]})])]),_:1},8,["model"])]),_:1},8,["open","title"])}}}),ce=ae(Ge,[["__scopeId","data-v-8a6c21af"]]),Xe={class:"ant-upload-drag-icon"},et={style:{display:"flex","justify-content":"flex-end",gap:"8px","margin-top":"24px"}},tt=le({__name:"BomUploadModal",props:{visible:{type:Boolean,default:!1}},emits:["update:visible","submit"],setup(v,{emit:g}){const f=v,p=g,s=m([]);function n(c){return s.value=[c],!1}function R(c){s.value=[]}function q({onSuccess:c}){setTimeout(()=>{c&&c()},1e3)}function y(){p("submit",s.value[0]),p("update:visible",!1),s.value=[]}function O(){p("update:visible",!1),s.value=[]}return pe(()=>f.visible,c=>{c||(s.value=[])}),(c,o)=>{const I=r("a-upload-dragger"),C=r("a-button"),h=r("a-modal");return W(),Z(h,{visible:v.visible,title:"上传BOM",onOk:y,onCancel:O,footer:null,width:"480px"},{default:a(()=>[l(I,{"file-list":s.value,"before-upload":n,"on-remove":R,"custom-request":q,accept:".xls,.xlsx",style:{"margin-bottom":"16px"}},{default:a(()=>[d("p",Xe,[l(V(ne),{style:{"font-size":"48px",color:"#1677ff"}})]),o[0]||(o[0]=d("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域",-1)),o[1]||(o[1]=d("p",{class:"ant-upload-hint"},"支持文件格式：.xls, .xlsx",-1))]),_:1,__:[0,1]},8,["file-list"]),d("div",et,[l(C,{onClick:O},{default:a(()=>o[2]||(o[2]=[x("取消")])),_:1,__:[2]}),l(C,{type:"primary",disabled:s.value.length===0,onClick:y},{default:a(()=>o[3]||(o[3]=[x("确定")])),_:1,__:[3]},8,["disabled"])])]),_:1},8,["visible"])}}}),lt=ae(tt,[["__scopeId","data-v-d0cecfc4"]]),at={class:"top-controls-wrapper"},nt={class:"left-aligned-section"},ot={class:"select-container device-model-select",style:{"margin-left":"10px"}},it={class:"select-container manufacturer-select",style:{"margin-left":"10px"}},ut={class:"right-aligned-icons"},rt={class:"column-setting-panel",style:{"max-height":"300px","overflow-y":"auto"}},st={class:"setting-section"},dt={class:"section-header",style:{display:"flex","justify-content":"space-between"}},ct={class:"column-checkbox-item",style:{padding:"4px 0"}},pt={class:"table-container"},mt=["onClick"],vt=["onClick"],ft=le({__name:"MovementProduction",setup(v,{expose:g}){const f=T(()=>({...se,Pagination:{...se.Pagination,page:""}})),p=[{key:"rowIndex",title:"序号",dataIndex:"rowIndex",width:60,fixed:"left",customRender:({index:e})=>($.value-1)*j.value+e+1},{key:"deviceModel",title:"设备型号",dataIndex:"deviceModel",width:100},{key:"productionBatch",title:"生产批次",dataIndex:"productionBatch",width:120,sorter:(e,t)=>new Date(e.productionBatch).getTime()-new Date(t.productionBatch).getTime(),sortDirections:["ascend","descend"]},{key:"manufacturer",title:"生产厂家",dataIndex:"manufacturer",width:180},{key:"burnedFirmware",title:"烧录固件",dataIndex:"burnedFirmware",width:120},{key:"unitPrice",title:"单价（元）",dataIndex:"unitPrice",width:100,sorter:(e,t)=>e.unitPrice-t.unitPrice,sortDirections:["ascend","descend"]},{key:"quantity",title:"数量（个）",dataIndex:"quantity",width:100,sorter:(e,t)=>e.quantity-t.quantity,sortDirections:["ascend","descend"]},{key:"totalPrice",title:"总价（元）",dataIndex:"totalPrice",width:120,sorter:(e,t)=>parseFloat(e.totalPrice)-parseFloat(t.totalPrice),sortDirections:["ascend","descend"]},{key:"creator",title:"创建人",dataIndex:"creator",width:100,customRender:({record:e})=>e.creator},{key:"creationTime",title:"创建时间",dataIndex:"creationTime",width:160,sorter:(e,t)=>new Date(e.creationTime).getTime()-new Date(t.creationTime).getTime(),sortDirections:["ascend","descend"]},{key:"updateTime",title:"更新时间",dataIndex:"updateTime",width:160,sorter:(e,t)=>new Date(e.updateTime).getTime()-new Date(t.updateTime).getTime(),sortDirections:["ascend","descend"]},{key:"operation",title:"操作",dataIndex:"",width:280,fixed:"right"}],s=m(p.map(e=>e.key)),n=m(p.map(e=>e.key)),R=e=>e.map(t=>({title:t.title,dataIndex:t.dataIndex,key:t.key,width:t.width,fixed:t.fixed,sorter:t.sorter,sortDirections:t.sortDirections,sortOrder:B.value&&t.key===B.value.columnKey?B.value.order:void 0,defaultSortOrder:t.defaultSortOrder,customRender:t.customRender?t.customRender:({text:i})=>i==null||i===""?"-":i})),q=T(()=>{const e=s.value.filter(i=>n.value.includes(i)).map(i=>p.find(_=>_.key===i)).filter(Boolean);return R(e).sort((i,_)=>{const b={left:1,undefined:2,right:3},P=b[i.fixed]||2,M=b[_.fixed]||2;return P-M})}),y=[],O=["HWSZ001","HWSZ002","HWSZ003"],c=["深圳沃能威科技有限公司","上海智造电子有限公司","北京创新科技有限公司"],o=["https://randomuser.me/api/portraits/men/33.jpg","https://randomuser.me/api/portraits/men/34.jpg"],I=["张三","李四"];y.length=0;for(let e=0;e<12;e++)y.push({key:e+1,deviceModel:O[e%O.length],productionBatch:`2025-06-${10+e%20}`,manufacturer:c[e%c.length],burnedFirmware:`Z00${e%4+1} V ${e%3+1}.${e%2+1}`,unitPrice:80+e%3*5+.75,quantity:500+e*10,totalPrice:(80+e%3*5+.75)*(500+e*10)+"",creator:I[e%2],creatorAvatar:o[e%2],creationTime:`2025-7-${13+e%10} 19:25:11`,updateTime:`2025-7-${13+e%10} 19:25:11`});console.log("Raw Data:",y);const C=m({key:"all",label:"全部",value:"all"}),h=m({key:"all",label:"全部",value:"all"}),J=m({key:"all",label:"全部",value:"all"}),A=m({key:"all",label:"全部",value:"all"}),w=m({key:"all",label:"全部",value:"all"}),U=T(()=>{const e=Array.from(new Set(y.map(t=>t.deviceModel)));return[{key:"all",value:"all",label:"全部"},...e.map(t=>({key:t,value:t,label:t}))]}),F=T(()=>{const e=Array.from(new Set(y.map(t=>t.manufacturer)));return[{key:"all",value:"all",label:"全部"},...e.map(t=>({key:t,value:t,label:t}))]}),k=e=>{h.value=!e||!e.value||e.value==="all"?{key:"all",label:"全部",value:"all"}:e},me=e=>{w.value=!e||!e.value||e.value==="all"?{key:"all",label:"全部",value:"all"}:e},$=m(1),j=m(10);console.log("Initial deviceModelValue:",h.value);const B=m({columnKey:"updateTime",order:"descend"}),ve=T(()=>({total:Q.value.length,current:$.value,pageSize:j.value,showSizeChanger:!0,pageSizeOptions:["10","20","50"],showTotal:(e,t)=>`第${t[0]}-${t[1]}条/共${e}条`,showQuickJumper:{goButton:"页"}})),fe=()=>{console.log("Refresh button clicked!"),G.value=!0,z.value="",$.value=1,ue(),C.value={key:"all",label:"全部",value:"all"},h.value={key:"all",label:"全部",value:"all"},J.value={key:"all",label:"全部",value:"all"},A.value={key:"all",label:"全部",value:"all"},w.value={key:"all",label:"全部",value:"all"},setTimeout(()=>{G.value=!1},500)},Q=T(()=>{var _;let e=[...y];if(z.value){const b=z.value.toLowerCase();e=e.filter(P=>Object.values(P).some(M=>typeof M=="string"&&M.toLowerCase().includes(b)))}if(h.value&&h.value.value!=="all"&&h.value.value!==""&&(e=e.filter(b=>b.deviceModel===h.value.value)),w.value&&w.value.value!=="all"&&w.value.value!==""&&(e=e.filter(b=>b.manufacturer===w.value.value)),B.value&&B.value.order){const{columnKey:b,order:P}=B.value,M=(_=p.find(D=>D.key===b))==null?void 0:_.sorter;M&&e.sort((D,ee)=>{const H=M(D,ee);return P==="ascend"?H:-H})}const t=($.value-1)*j.value,i=t+j.value;return e.slice(t,i)}),z=m(""),oe=(e,t,i)=>{console.log("Table change:",e,t,i);const _=Array.isArray(i)?i[0]:i;_&&_.order?B.value={columnKey:_.columnKey,order:_.order}:B.value={columnKey:"updateTime",order:"descend"},$.value=1},ye=()=>{console.log("Setting clicked")},G=m(!1),ie=m("middle"),_e=({key:e})=>{ie.value=e},ue=()=>{n.value=p.map(e=>e.key),s.value=p.map(e=>e.key)},be=e=>{const{newIndex:t,oldIndex:i}=e,_=s.value[i],b=[...s.value];b.splice(i,1),b.splice(t,0,_),s.value=b},ge=(e,t)=>{t?n.value.includes(e)||n.value.push(e):n.value=n.value.filter(i=>i!==e)},X=m(!1),he=T(()=>Array.from(new Set(y.map(e=>e.deviceModel)))),ke=()=>{X.value=!1},we=e=>{X.value=!1},L=m(!1),Y=m(null),re=e=>{Y.value={...e},L.value=!0},xe=e=>{var i;const t=y.findIndex(_=>_.key===Y.value.key);t!==-1&&(y[t]={...y[t],...e,productionBatch:(i=e.productionBatch)!=null&&i.format?e.productionBatch.format("YYYY-MM-DD"):e.productionBatch,totalPrice:(e.unitPrice*e.quantity).toString(),updateTime:new Date().toLocaleString()}),L.value=!1,Y.value=null},N=m(!1),Ce=m(null);function Me(e){console.log("Upload clicked",e),Ce.value=e,N.value=!0}function Oe(e){N.value=!1}const E=m(!1);function Be(){E.value=!0}function Se(e){var t;y.unshift({key:y.length+1,deviceModel:e.deviceModel,productionBatch:(t=e.productionBatch)!=null&&t.format?e.productionBatch.format("YYYY-MM-DD"):e.productionBatch,manufacturer:e.manufacturer,burnedFirmware:e.burnedFirmware,unitPrice:e.unitPrice,quantity:e.quantity,totalPrice:(e.unitPrice*e.quantity).toString(),creator:"admin",creatorAvatar:"",creationTime:new Date().toLocaleString(),updateTime:new Date().toLocaleString()}),E.value=!1}return $e(()=>{n.value=p.map(e=>e.key)}),g({handleTableChange:oe}),(e,t)=>{const i=r("a-select-option"),_=r("a-select"),b=r("a-tooltip"),P=r("a-input"),M=r("a-button"),D=r("a-menu-item"),ee=r("a-menu"),H=r("a-dropdown"),qe=r("a-checkbox"),Pe=r("a-popover"),te=r("a-divider"),De=r("a-popconfirm"),Te=r("a-space"),Ve=r("a-table"),Ie=r("a-config-provider");return W(),Z(Ie,{locale:f.value,theme:{algorithm:V(Ne).defaultAlgorithm}},{default:a(()=>[t[20]||(t[20]=d("div",{class:"title-container"},[d("h2",null,"机芯生产")],-1)),d("div",at,[d("div",nt,[d("div",ot,[t[9]||(t[9]=d("span",{class:"select-always-placeholder"},"设备型号:",-1)),l(b,{title:h.value.label},{default:a(()=>[l(_,{value:h.value,"onUpdate:value":t[0]||(t[0]=u=>h.value=u),style:{width:"130px"},options:U.value,onChange:k,allowClear:!0,"label-in-value":"",class:"device-model-select"},{default:a(()=>[l(i,{value:"all"},{default:a(()=>t[8]||(t[8]=[x("全部")])),_:1,__:[8]})]),_:1},8,["value","options"])]),_:1},8,["title"])]),d("div",it,[t[11]||(t[11]=d("span",{class:"select-always-placeholder"},"生产厂家:",-1)),l(b,{title:w.value.label},{default:a(()=>[l(_,{value:w.value,"onUpdate:value":t[1]||(t[1]=u=>w.value=u),style:{width:"130px"},options:F.value,onChange:me,allowClear:!0,"label-in-value":"",class:"manufacturer-select"},{default:a(()=>[l(i,{value:"all"},{default:a(()=>t[10]||(t[10]=[x("全部")])),_:1,__:[10]})]),_:1},8,["value","options"])]),_:1},8,["title"])])]),d("div",ut,[l(P,{value:z.value,"onUpdate:value":t[2]||(t[2]=u=>z.value=u),placeholder:"输入关键字搜索",style:{width:"200px"}},{prefix:a(()=>[l(V(ze))]),_:1},8,["value"]),l(M,{type:"primary",onClick:Be},{default:a(()=>t[12]||(t[12]=[x("新增批次")])),_:1,__:[12]}),l(V(Ae),{onClick:fe}),l(H,null,{overlay:a(()=>[l(ee,{onClick:_e},{default:a(()=>[l(D,{key:"large"},{default:a(()=>t[13]||(t[13]=[x("宽松")])),_:1,__:[13]}),l(D,{key:"middle"},{default:a(()=>t[14]||(t[14]=[x("中等")])),_:1,__:[14]}),l(D,{key:"small"},{default:a(()=>t[15]||(t[15]=[x("紧凑")])),_:1,__:[15]})]),_:1})]),default:a(()=>[l(V(Ee),{onClick:t[3]||(t[3]=je(()=>{},["prevent"]))})]),_:1}),l(Pe,{trigger:"click",placement:"bottomRight"},{content:a(()=>[d("div",rt,[d("div",st,[d("div",dt,[t[17]||(t[17]=d("span",null,"列展示",-1)),l(M,{type:"link",onClick:ue},{default:a(()=>t[16]||(t[16]=[x("重置")])),_:1,__:[16]})]),l(V(He),{modelValue:s.value,"onUpdate:modelValue":t[4]||(t[4]=u=>s.value=u),"item-key":"key",onEnd:be,class:"column-checkbox-group"},{item:a(({element:u})=>[d("div",ct,[l(qe,{checked:n.value.includes(u),onChange:S=>ge(u,S.target.checked)},{default:a(()=>{var S;return[x(Le((S=p.find(K=>K.key===u))==null?void 0:S.title),1)]}),_:2},1032,["checked","onChange"])])]),_:1},8,["modelValue"])])])]),default:a(()=>[l(V(Ze),{onClick:ye})]),_:1})])]),d("div",pt,[l(Ve,{rowKey:"key",columns:q.value,"data-source":Q.value,pagination:Q.value.length===0?!1:ve.value,loading:G.value,size:ie.value,scroll:{x:1e3},onChange:oe,showSorterTooltip:!1,onEditRecord:re},{bodyCell:a(({column:u,record:S})=>[u.key==="operation"?(W(),Z(Te,{key:0,class:"action-cell",direction:"horizontal"},{default:a(()=>[d("a",{class:"edit-link",onClick:K=>re(S)},"编辑",8,mt),l(te,{type:"vertical"}),d("a",{class:"edit-link",onClick:K=>Me(S)},"上传",8,vt),l(te,{type:"vertical"}),t[19]||(t[19]=d("a",{class:"download-link"},"下载BOM",-1)),l(te,{type:"vertical"}),l(De,{title:"确定要删除该信息吗?",onConfirm:K=>e.$emit("delete-record",S)},{default:a(()=>t[18]||(t[18]=[d("a",{class:"danger-link"},"删除",-1)])),_:2,__:[18]},1032,["onConfirm"])]),_:2,__:[19]},1024)):Ye("",!0)]),_:1},8,["columns","data-source","pagination","loading","size"])]),l(Ke,{visible:X.value,uniqueDeviceModels:he.value,"onUpdate:visible":ke,onSubmit:we},null,8,["visible","uniqueDeviceModels"]),l(ce,{open:E.value,"onUpdate:open":t[5]||(t[5]=u=>E.value=u),deviceModelOptions:U.value.filter(u=>u.value!=="all"),manufacturerOptions:F.value.filter(u=>u.value!=="all"),onSubmit:Se},null,8,["open","deviceModelOptions","manufacturerOptions"]),l(ce,{open:L.value,"onUpdate:open":t[6]||(t[6]=u=>L.value=u),title:"编辑批次",deviceModelOptions:U.value.filter(u=>u.value!=="all"),manufacturerOptions:F.value.filter(u=>u.value!=="all"),initialValues:Y.value,onSubmit:xe},null,8,["open","deviceModelOptions","manufacturerOptions","initialValues"]),l(lt,{visible:N.value,"onUpdate:visible":t[7]||(t[7]=u=>N.value=u),onSubmit:Oe},null,8,["visible"])]),_:1,__:[20]},8,["locale","theme"])}}}),kt=ae(ft,[["__scopeId","data-v-86da4c69"]]);export{kt as default};
