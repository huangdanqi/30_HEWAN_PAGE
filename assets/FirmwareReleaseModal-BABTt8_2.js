import{d as P,r as b,a as Q,j as W,p as x,i as c,o as n,f as r,w as s,e as l,b as _,c as y,n as v,g as p,F as $,v as T,t as k,l as X,h as M,_ as Y}from"./index-CtWBKoTV.js";import{I as Z}from"./InboxOutlined-BOa_tbmU.js";const ee={class:"steps-content"},te={key:0},ae={style:{"margin-top":"8px"}},se={key:1},le={class:"ant-upload-drag-icon"},oe={key:0,style:{"margin-top":"16px"}},ne={class:"steps-action"},S=15,re=P({__name:"FirmwareReleaseModal",props:{visible:{type:Boolean,default:!1},uniqueDeviceModels:{type:Array,default:()=>[]}},emits:["update:visible","submit"],setup(w,{emit:j}){const D=j,d=b(0),R=b(null),f=b([]),t=Q({isFirstRelease:!0,deviceModel:"",releaseType:"major",contentDescription:""}),q={deviceModel:[{required:!0,message:"请选择设备型号"}],contentDescription:[{required:!0,message:"请输入内容描述"}],isFirstRelease:[{required:!0,message:"请选择是否首版发布"}],releaseType:[{required:!0,message:"请选择发布版本"}]},L=W(()=>{const a="1.0.0",e=a.split(".").map(Number);if(t.isFirstRelease)return`V ${e[0]}.0.0`;switch(t.releaseType){case"major":return`V ${e[0]+1}.0.0`;case"minor":return`V ${e[0]}.${e[1]+1}.0`;case"revision":return`V ${e[0]}.${e[1]}.${e[2]+1}`;default:return`V ${a}`}});x(()=>t.deviceModel,a=>{if(a.replace(/\s/g,"").length>S){let i=0,m="";for(let u of a){if(u!==" "&&i++,i>S)break;m+=u}t.deviceModel=m}}),x(()=>t.isFirstRelease,a=>{a&&(t.releaseType="major"),t.deviceModel=""}),x(()=>t.contentDescription,a=>{if(a.replace(/\s/g,"").length>1e4){let i=0,m="";for(let u of a){if(u!==" "&&i++,i>1e4)break;m+=u}t.contentDescription=m}});const U=async()=>{var a;try{await((a=R.value)==null?void 0:a.validateFields()),d.value++}catch(e){console.error("Validation Failed:",e)}},B=()=>{d.value--},N=()=>{console.log("Form State:",t),console.log("File List:",f.value),M.success("固件发布成功!"),D("submit",{formState:t,files:f.value}),V()},V=()=>{d.value=0,t.isFirstRelease=!0,t.deviceModel="",t.releaseType="major",t.contentDescription="",f.value=[],D("update:visible",!1)},I=a=>{let e=[...a.fileList];e=e.slice(-1),e=e.map(i=>(i.response&&(i.url=i.response.url),i)),f.value=e,a.file.status==="done"?M.success(`${a.file.name} 文件上传成功.`):a.file.status==="error"&&M.error(`${a.file.name} 文件上传失败.`)},A=a=>{console.log(a)};return(a,e)=>{const i=r("a-step"),m=r("a-steps"),u=r("a-radio"),C=r("a-radio-group"),g=r("a-form-item"),E=r("a-input"),O=r("a-select-option"),h=r("a-select"),z=r("a-textarea"),G=r("a-form"),H=r("a-upload-dragger"),J=r("a-progress"),F=r("a-button"),K=r("a-modal");return n(),c(K,{visible:w.visible,title:"版本发布",footer:null,onCancel:V,width:"600px"},{default:s(()=>[l(m,{current:d.value},{default:s(()=>[l(i,{title:"版本选择"}),l(i,{title:"固件上传"})]),_:1},8,["current"]),_("div",ee,[d.value===0?(n(),y("div",te,[l(G,{model:t,rules:q,ref_key:"step1Form",ref:R,layout:"vertical"},{default:s(()=>[l(g,{label:"首版发布",name:"isFirstRelease"},{default:s(()=>[l(C,{value:t.isFirstRelease,"onUpdate:value":e[0]||(e[0]=o=>t.isFirstRelease=o)},{default:s(()=>[l(u,{value:!0},{default:s(()=>e[5]||(e[5]=[p("是")])),_:1,__:[5]}),l(u,{value:!1},{default:s(()=>e[6]||(e[6]=[p("否")])),_:1,__:[6]})]),_:1},8,["value"])]),_:1}),l(g,{label:"设备型号",name:"deviceModel"},{default:s(()=>[t.isFirstRelease?(n(),c(E,{key:0,value:t.deviceModel,"onUpdate:value":e[1]||(e[1]=o=>t.deviceModel=o),placeholder:"请输入（最多15个字符，不含空格）",maxlength:30},null,8,["value"])):(n(),c(h,{key:1,value:t.deviceModel,"onUpdate:value":e[2]||(e[2]=o=>t.deviceModel=o),placeholder:"请选择"},{default:s(()=>[(n(!0),y($,null,T(w.uniqueDeviceModels,o=>(n(),c(O,{key:o,value:o},{default:s(()=>[p(k(o),1)]),_:2},1032,["value"]))),128))]),_:1},8,["value"]))]),_:1}),t.isFirstRelease?v("",!0):(n(),c(g,{key:0,label:"发布版本",name:"releaseType"},{default:s(()=>[l(C,{value:t.releaseType,"onUpdate:value":e[3]||(e[3]=o=>t.releaseType=o)},{default:s(()=>[l(u,{value:"major"},{default:s(()=>e[7]||(e[7]=[p("主版本")])),_:1,__:[7]}),l(u,{value:"minor"},{default:s(()=>e[8]||(e[8]=[p("子版本")])),_:1,__:[8]}),l(u,{value:"revision"},{default:s(()=>e[9]||(e[9]=[p("修订版")])),_:1,__:[9]})]),_:1},8,["value"]),_("p",ae,"本次将发布为 "+k(L.value)+" 版本",1)]),_:1})),l(g,{label:"内容描述",name:"contentDescription"},{default:s(()=>[l(z,{value:t.contentDescription,"onUpdate:value":e[4]||(e[4]=o=>t.contentDescription=o),placeholder:"请输入（最多10000个字符，不含空格）",rows:4,maxlength:10020},null,8,["value"])]),_:1})]),_:1},8,["model"])])):v("",!0),d.value===1?(n(),y("div",se,[l(H,{name:"file",multiple:!1,action:"/upload.do",onChange:I,onDrop:A},{default:s(()=>[_("p",le,[l(X(Z))]),e[10]||(e[10]=_("p",{class:"ant-upload-text"},"点击或拖拽文件到此区域",-1)),e[11]||(e[11]=_("p",{class:"ant-upload-hint"}," 请按照模板上传文件进行设备导入。支持文件格式: .xls, .xlsx。 ",-1))]),_:1,__:[10,11]}),f.value.length>0?(n(),y("div",oe,[(n(!0),y($,null,T(f.value,o=>(n(),y("div",{key:o.uid},[l(J,{percent:o.percent||0},null,8,["percent"]),_("span",null,k(o.name),1)]))),128))])):v("",!0)])):v("",!0)]),_("div",ne,[d.value<1?(n(),c(F,{key:0,type:"primary",onClick:U},{default:s(()=>e[12]||(e[12]=[p("下一步")])),_:1,__:[12]})):v("",!0),d.value>0?(n(),c(F,{key:1,style:{"margin-left":"8px"},onClick:B},{default:s(()=>e[13]||(e[13]=[p("上一步")])),_:1,__:[13]})):v("",!0),d.value===1?(n(),c(F,{key:2,type:"primary",onClick:N,style:{"margin-left":"8px"}},{default:s(()=>e[14]||(e[14]=[p(" 确定 ")])),_:1,__:[14]})):v("",!0)])]),_:1},8,["visible"])}}}),de=Y(re,[["__scopeId","data-v-9d813038"]]);export{de as F};
